---
interface Props {
    darkModeUrl: string;
    lightModeUrl: string;
    className?: string;
    loading?: 'eager' | 'lazy';
    alt?: string;
}

const { darkModeUrl, lightModeUrl, alt, className = '', loading = 'lazy' } = Astro.props;
---

<img class={className} id="img" loading={loading} alt={alt} />

<script define:vars={{ darkModeUrl, lightModeUrl }}>
    const image = document.getElementById('img');

    const updateImage = () => {
        const theme = document.documentElement.dataset.theme;
        const src = theme === 'dark' ? darkModeUrl : lightModeUrl;
        image.src = src;
    };

    const observer = new MutationObserver((mutations) => {
        if (mutations.filter((m) => m.attributeName === 'data-theme').length > 0) {
            updateImage();
        }
    });
    observer.observe(document.documentElement, { attributes: true });

    updateImage();
</script>
